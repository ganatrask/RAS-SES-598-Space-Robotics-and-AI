# Cart-Pole Optimal Control under Earthquake Disturbances

This repository contains the implementation and analysis of an LQR controller for a cart-pole system subjected to earthquake disturbances. The objective is to maintain the stability of the inverted pendulum while ensuring the cart remains within its ±2.5 m range, even under significant external perturbations.

## 1. Introduction

The cart-pole system, featuring an inverted pendulum mounted on a cart, is a classic benchmark in control systems. In this implementation, the system is challenged by earthquake-like disturbances generated by a force generator that superimposes multiple sine waves with random variations and added Gaussian noise. This report summarizes the analysis and tuning process, focusing on baseline performance, parameter effects, and disturbance response.

## 2. System Description

### Physical Setup:
- Cart Traversal Range: ±2.5 m (total 5 m)
- Pole Length: 1 m
- Cart Mass: 1.0 kg
- Pole Mass: 1.0 kg

### Disturbance Generator:
- Base Amplitude: Initially 15 N, increased to as high as 50 N during testing
- Frequency Range: 0.5–4.0 Hz
- Additional Variations: Random amplitude and phase shifts plus Gaussian noise

## 3. Baseline Performance

### Initial System Behavior
- **Default Parameters**: Q = [1.0, 1.0, 10.0, 10.0], R = 0.1
- **Observations**:
  - Setting "x" weight to 5 caused rapid cart movement and pole instability
  - Adjusting "x_dot" weight to 0.1 increased balance time but caused rapid cart movement
  - Increasing "x_dot" weight to 9 minimized position movement and stabilized the system

### Key Issues Identified:
- Over-aggressive control caused instability
- Low responsiveness to external disturbances

## 4. Parameter Effects and Tuning

### Q Matrix Effects:
- **Cart Position (x)**: High weights destabilized the pole
- **Cart Velocity (x_dot)**: Increasing weight improved position control
- **Pole Angle (theta)**: High weights caused oscillations
- **Pole Angular Velocity (theta_dot)**: Adjustments impacted pole stability

### R Value Impact:
- Lower R (0.1) increased control aggressiveness, improving stabilization but amplifying oscillations

### Trade-offs Observed:
- High Q weights prioritized specific objectives but reduced overall stability
- Low R improved responsiveness at the cost of energy efficiency

### Tuning Process
The controller was initially configured with Q = diag([1.0, 1.0, 10.0, 10.0]) and R = [[0.1]]. Through systematic tuning, we explored multiple configurations:

| Configuration | Max Cart Disp. | Max Pole Angle | Stability Duration | Comments |
|---------------|----------------|----------------|-------------------|----------|
| [1.0, 1.0, 10.0, 10.0], R=0.1 | High | Medium | Limited | Default behavior |
| [5.0, 0.1, 10.0, 10.0], R=0.1 | High | High | Very short | Unstable |
| [1.0, 9.0, 1.0, 9.0], R=0.1 | Low | Low | Extended | Optimal performance |

## 5. Final Parameters

### Optimized Parameters:
- **Q = [1.0, 9.0, 1.0, 9.0]**
- **R = 0.1**

### Results:
- Stable cart-pole balance with minimal position movement
- Smooth disturbance recovery and reduced oscillations
- Extended duration of stability under earthquake conditions

### LQR Implementation:
```python
# State space matrices
A = np.array([
    [0, 1, 0, 0],
    [0, 0, (m * g) / M, 0],
    [0, 0, 0, 1],
    [0, 0, ((M + m) * g) / (M * L), 0]
])

B = np.array([
    [0],
    [1/M],
    [0],
    [-1/(M * L)]
])

# Optimized LQR cost matrices
Q = np.diag([1.0, 9.0, 1.0, 9.0])  # State cost
R = np.array([[0.1]])            # Control cost

# Compute LQR gain
K = compute_lqr_gain(A, B, Q, R)
```

## 6. Disturbance Response

### Low-frequency Disturbances:
- Smooth recovery with minor oscillations
- Effective position control maintained

### High-frequency Disturbances:
- Stable balance with higher control effort
- System remained within physical constraints

## 7. Installation and Setup

### Prerequisites
- ROS2 Humble or Jazzy
- Gazebo Garden
- Python 3.8+
- Required Python packages: numpy, scipy, matplotlib

### Installation Commands
```bash
# Set ROS_DISTRO as per your configuration
export ROS_DISTRO=humble

# Install ROS2 packages
sudo apt update
sudo apt install -y \
    ros-$ROS_DISTRO-ros-gz-bridge \
    ros-$ROS_DISTRO-ros-gz-sim \
    ros-$ROS_DISTRO-ros-gz-interfaces \
    ros-$ROS_DISTRO-robot-state-publisher \
    ros-$ROS_DISTRO-rviz2

# Install Python dependencies
pip3 install numpy scipy matplotlib
```

## 8. Running the Simulation

To run the simulation with visualization:
```bash
ros2 launch cart_pole_optimal_control cart_pole_rviz.launch.py
```

This launches:
- Gazebo simulation (headless mode)
- RViz visualization
- LQR controller
- Earthquake force generator
- Force visualizer

## 9. Performance Analysis

### Logging and Analysis
The LQR controller logs performance data to CSV files for analysis:
```bash
# Run the analysis script on the most recent log
python analyze_lqr_logs.py
```

### Stability Metrics
- Maximum Pole Angle Deviation: Remains within acceptable limits
- RMS Cart Position Error: Significantly reduced with tuned parameters
- Peak Control Force: Higher during disturbance events
- Recovery Time: Rapid recovery after disturbances

### Visualization
The analysis script generates plots for:
- Cart Position (m)
- Pendulum Angle (degrees)
- Control Force (N)
- Phase space diagrams

## 10. Discussion and Recommendations

### Lessons Learned:
- Small changes in Q and R values greatly affect system behavior
- Balancing control aggressiveness and stability is critical
- Systematic parameter tuning significantly improves performance

### Recommendations:
- Automate parameter tuning for more optimal results
- Explore adaptive control strategies for dynamic environments
- Consider implementing reinforcement learning for comparison

## 11. Conclusion

The optimized controller (Q = [1.0, 9.0, 1.0, 9.0], R = 0.1) achieved a well-balanced system with effective disturbance handling and minimal energy use. This implementation showcases the importance of iterative tuning and the practical challenges of managing multiple control objectives. The insights and analysis presented here will be valuable for applications involving dynamic disturbances, such as the optimal control of space robots and other high-stakes robotic systems.

## Video Demonstration

[Link to video demonstration]()
